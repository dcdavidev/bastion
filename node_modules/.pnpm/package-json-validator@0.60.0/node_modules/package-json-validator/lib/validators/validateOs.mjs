import { ChildResult, Result } from "../Result.mjs";

//#region src/validators/validateOs.ts
const VALID_OSS = [
	"aix",
	"android",
	"darwin",
	"freebsd",
	"linux",
	"openbsd",
	"sunos",
	"win32"
];
/**
* Validate the `os` field in a package.json, which should be an array of
* valid operating systems.
* @example ["linux", "win32"]
* @see https://docs.npmjs.com/cli/v11/configuring-npm/package-json#os
*/
const validateOs = (obj) => {
	const result = new Result();
	if (Array.isArray(obj)) for (let i = 0; i < obj.length; i++) {
		const childResult = new ChildResult(i);
		const item = obj[i];
		if (typeof item !== "string") {
			const itemType = item === null ? "null" : typeof item;
			childResult.addIssue(`item at index ${i} should be a string, not \`${itemType}\``);
		} else if (item.trim() === "") childResult.addIssue(`item at index ${i} is empty, but should be the name of an operating system`);
		else if (!VALID_OSS.includes(item)) childResult.addIssue(`the value "${item}" is not valid. Valid OS values are: ${VALID_OSS.join(", ")}`);
		result.addChildResult(childResult);
	}
	else if (obj == null) result.addIssue("the value is `null`, but should be an `Array` of strings");
	else {
		const valueType = typeof obj;
		result.addIssue(`the type should be \`Array\`, not \`${valueType}\``);
	}
	return result;
};

//#endregion
export { validateOs };