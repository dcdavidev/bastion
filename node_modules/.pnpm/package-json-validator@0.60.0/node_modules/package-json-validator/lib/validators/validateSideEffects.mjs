import { ChildResult, Result } from "../Result.mjs";

//#region src/validators/validateSideEffects.ts
/**
* Validate the `sideEffects` property in a package.json, which can either be
* a boolean or an array of non-empty strings.
*@see https://webpack.js.org/guides/tree-shaking/#with-sideeffects-false-in-packagejson
*/
const validateSideEffects = (value) => {
	const result = new Result();
	if (typeof value === "boolean") return result;
	else if (Array.isArray(value)) for (let i = 0; i < value.length; i++) {
		const childResult = new ChildResult(i);
		const item = value[i];
		if (typeof item !== "string") {
			const itemType = item === null ? "null" : typeof item;
			childResult.addIssue(`item at index ${i} should be a string, not \`${itemType}\``);
		} else if (item.trim() === "") childResult.addIssue(`item at index ${i} is empty, but should be a path to a file with side effects or a glob pattern`);
		result.addChildResult(childResult);
	}
	else if (value == null) result.addIssue("the value is `null`, but should be a `boolean` or an `Array`");
	else {
		const valueType = typeof value;
		result.addIssue(`the type should be \`boolean\` or \`Array\`, not \`${valueType}\``);
	}
	return result;
};

//#endregion
export { validateSideEffects };